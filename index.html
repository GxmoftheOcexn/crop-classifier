<!DOCTYPE html>
<html>
<head>
  <title>Crop Classifier</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image"></script>
</head>
<body>
  <input type="file" accept="image/*" onchange="predictImage(event)" />
  <h3 id="result">Prediction: </h3>

  <script>
    const URL = "https://teachablemachine.withgoogle.com/models/7IE0URe2N_/";
    let model, labelContainer;

    async function loadModel() {
      model = await tmImage.load(URL + "model.json", URL + "metadata.json");
    }

    async function predictImage(event) {
      const file = event.target.files[0];
      const image = new Image();
      image.src = URL.createObjectURL(file);
      await image.decode();

      const prediction = await model.predict(image);
      const best = prediction.reduce((a, b) => (a.probability > b.probability ? a : b));
      document.getElementById("result").innerText = "Prediction: " + best.className;

      // If accessed via MIT App Inventor WebViewer, post the result back
      if (window.AppInventor) {
        window.AppInventor.setWebViewString(best.className);
      }
    }

    loadModel();
  </script>
</body>
</html>
